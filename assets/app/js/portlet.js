var mPortlet=function(elementId,options){var the=this;var init=!1;var element=mUtil.get(elementId);var body=mUtil.get('body');if(!element){return}
var defaultOptions={bodyToggleSpeed:400,tooltips:!0,tools:{toggle:{collapse:'Collapse',expand:'Expand'},reload:'Reload',remove:'Remove',fullscreen:{on:'Fullscreen',off:'Exit Fullscreen'}},sticky:{offset:300,zIndex:101}};var Plugin={construct:function(options){if(mUtil.data(element).has('portlet')){the=mUtil.data(element).get('portlet')}else{Plugin.init(options);Plugin.build();mUtil.data(element).set('portlet',the)}
return the},init:function(options){the.element=element;the.events=[];the.options=mUtil.deepExtend({},defaultOptions,options);the.head=mUtil.child(element,'.m-portlet__head');the.foot=mUtil.child(element,'.m-portlet__foot');if(mUtil.child(element,'.m-portlet__body')){the.body=mUtil.child(element,'.m-portlet__body')}else if(mUtil.child(element,'.m-form').length!==0){the.body=mUtil.child(element,'.m-form')}},build:function(){var remove=mUtil.find(the.head,'[m-portlet-tool=remove]');if(remove){mUtil.addEvent(remove,'click',function(e){e.preventDefault();Plugin.remove()})}
var reload=mUtil.find(the.head,'[m-portlet-tool=reload]');if(reload){mUtil.addEvent(reload,'click',function(e){e.preventDefault();Plugin.reload()})}
var toggle=mUtil.find(the.head,'[m-portlet-tool=toggle]');if(toggle){mUtil.addEvent(toggle,'click',function(e){e.preventDefault();Plugin.toggle()})}
var fullscreen=mUtil.find(the.head,'[m-portlet-tool=fullscreen]');if(fullscreen){mUtil.addEvent(fullscreen,'click',function(e){e.preventDefault();Plugin.fullscreen()})}
Plugin.setupTooltips()},onScrollSticky:function(){var st=window.pageYOffset;var offset=the.options.sticky.offset;if(st>offset){if(mUtil.hasClass(body,'m-portlet--sticky')===!1){Plugin.eventTrigger('stickyOn');mUtil.addClass(body,'m-portlet--sticky');mUtil.addClass(element,'m-portlet--sticky');Plugin.updateSticky()}}else{if(mUtil.hasClass(body,'m-portlet--sticky')){Plugin.eventTrigger('stickyOff');mUtil.removeClass(body,'m-portlet--sticky');mUtil.removeClass(element,'m-portlet--sticky');Plugin.resetSticky()}}},initSticky:function(){if(!the.head){return}
window.addEventListener('scroll',Plugin.onScrollSticky)},updateSticky:function(){if(!the.head){return}
var top;if(mUtil.hasClass(body,'m-portlet--sticky')){if(the.options.sticky.position.top instanceof Function){top=parseInt(the.options.sticky.position.top.call())}else{top=parseInt(the.options.sticky.position.top)}
var left;if(the.options.sticky.position.left instanceof Function){left=parseInt(the.options.sticky.position.left.call())}else{left=parseInt(the.options.sticky.position.left)}
var right;if(the.options.sticky.position.right instanceof Function){right=parseInt(the.options.sticky.position.right.call())}else{right=parseInt(the.options.sticky.position.right)}
mUtil.css(the.head,'z-index',the.options.sticky.zIndex);mUtil.css(the.head,'top',top+'px');if(mUtil.isRTL()){mUtil.css(the.head,'left',right+'px');mUtil.css(the.head,'right',left+'px')}else{mUtil.css(the.head,'left',left+'px');mUtil.css(the.head,'right',right+'px')}}},resetSticky:function(){if(!the.head){return}
if(mUtil.hasClass(body,'m-portlet--sticky')===!1){mUtil.css(the.head,'z-index','');mUtil.css(the.head,'top','');mUtil.css(the.head,'left','');mUtil.css(the.head,'right','')}},destroySticky:function(){if(!the.head){return}
Plugin.resetSticky();window.removeEventListener('scroll',Plugin.onScrollSticky)},remove:function(){if(Plugin.eventTrigger('beforeRemove')===!1){return}
if(mUtil.hasClass(body,'m-portlet--fullscreen')&&mUtil.hasClass(element,'m-portlet--fullscreen')){Plugin.fullscreen('off')}
Plugin.removeTooltips();mUtil.remove(element);Plugin.eventTrigger('afterRemove')},setContent:function(html){if(html){the.body.innerHTML=html}},getBody:function(){return the.body},getSelf:function(){return element},setupTooltips:function(){if(the.options.tooltips){var collapsed=mUtil.hasClass(element,'m-portlet--collapse')||mUtil.hasClass(element,'m-portlet--collapsed');var fullscreenOn=mUtil.hasClass(body,'m-portlet--fullscreen')&&mUtil.hasClass(element,'m-portlet--fullscreen');var remove=mUtil.find(the.head,'[m-portlet-tool=remove]');if(remove){var placement=(fullscreenOn?'bottom':'top');var tip=new Tooltip(remove,{title:the.options.tools.remove,placement:placement,offset:(fullscreenOn?'0,10px,0,0':'0,5px'),trigger:'hover',template:'<div class="m-tooltip m-tooltip--portlet tooltip bs-tooltip-'+placement+'" role="tooltip">\
                            <div class="tooltip-arrow arrow"></div>\
                            <div class="tooltip-inner"></div>\
                        </div>'});mUtil.data(remove).set('tooltip',tip)}
var reload=mUtil.find(the.head,'[m-portlet-tool=reload]');if(reload){var placement=(fullscreenOn?'bottom':'top');var tip=new Tooltip(reload,{title:the.options.tools.reload,placement:placement,offset:(fullscreenOn?'0,10px,0,0':'0,5px'),trigger:'hover',template:'<div class="m-tooltip m-tooltip--portlet tooltip bs-tooltip-'+placement+'" role="tooltip">\
                            <div class="tooltip-arrow arrow"></div>\
                            <div class="tooltip-inner"></div>\
                        </div>'});mUtil.data(reload).set('tooltip',tip)}
var toggle=mUtil.find(the.head,'[m-portlet-tool=toggle]');if(toggle){var placement=(fullscreenOn?'bottom':'top');var tip=new Tooltip(toggle,{title:(collapsed?the.options.tools.toggle.expand:the.options.tools.toggle.collapse),placement:placement,offset:(fullscreenOn?'0,10px,0,0':'0,5px'),trigger:'hover',template:'<div class="m-tooltip m-tooltip--portlet tooltip bs-tooltip-'+placement+'" role="tooltip">\
                            <div class="tooltip-arrow arrow"></div>\
                            <div class="tooltip-inner"></div>\
                        </div>'});mUtil.data(toggle).set('tooltip',tip)}
var fullscreen=mUtil.find(the.head,'[m-portlet-tool=fullscreen]');if(fullscreen){var placement=(fullscreenOn?'bottom':'top');var tip=new Tooltip(fullscreen,{title:(fullscreenOn?the.options.tools.fullscreen.off:the.options.tools.fullscreen.on),placement:placement,offset:(fullscreenOn?'0,10px,0,0':'0,5px'),trigger:'hover',template:'<div class="m-tooltip m-tooltip--portlet tooltip bs-tooltip-'+placement+'" role="tooltip">\
                            <div class="tooltip-arrow arrow"></div>\
                            <div class="tooltip-inner"></div>\
                        </div>'});mUtil.data(fullscreen).set('tooltip',tip)}}},removeTooltips:function(){if(the.options.tooltips){var remove=mUtil.find(the.head,'[m-portlet-tool=remove]');if(remove&&mUtil.data(remove).has('tooltip')){mUtil.data(remove).get('tooltip').dispose()}
var reload=mUtil.find(the.head,'[m-portlet-tool=reload]');if(reload&&mUtil.data(reload).has('tooltip')){mUtil.data(reload).get('tooltip').dispose()}
var toggle=mUtil.find(the.head,'[m-portlet-tool=toggle]');if(toggle&&mUtil.data(toggle).has('tooltip')){mUtil.data(toggle).get('tooltip').dispose()}
var fullscreen=mUtil.find(the.head,'[m-portlet-tool=fullscreen]');if(fullscreen&&mUtil.data(fullscreen).has('tooltip')){mUtil.data(fullscreen).get('tooltip').dispose()}}},reload:function(){Plugin.eventTrigger('reload')},toggle:function(){if(mUtil.hasClass(element,'m-portlet--collapse')||mUtil.hasClass(element,'m-portlet--collapsed')){Plugin.expand()}else{Plugin.collapse()}},collapse:function(){if(Plugin.eventTrigger('beforeCollapse')===!1){return}
mUtil.slideUp(the.body,the.options.bodyToggleSpeed,function(){Plugin.eventTrigger('afterCollapse')});mUtil.addClass(element,'m-portlet--collapse');var toggle=mUtil.find(the.head,'[m-portlet-tool=toggle]');if(toggle&&mUtil.data(toggle).has('tooltip')){mUtil.data(toggle).get('tooltip').updateTitleContent(the.options.tools.toggle.expand)}},expand:function(){if(Plugin.eventTrigger('beforeExpand')===!1){return}
mUtil.slideDown(the.body,the.options.bodyToggleSpeed,function(){Plugin.eventTrigger('afterExpand')});mUtil.removeClass(element,'m-portlet--collapse');mUtil.removeClass(element,'m-portlet--collapsed');var toggle=mUtil.find(the.head,'[m-portlet-tool=toggle]');if(toggle&&mUtil.data(toggle).has('tooltip')){mUtil.data(toggle).get('tooltip').updateTitleContent(the.options.tools.toggle.collapse)}},fullscreen:function(mode){var d={};var speed=300;if(mode==='off'||(mUtil.hasClass(body,'m-portlet--fullscreen')&&mUtil.hasClass(element,'m-portlet--fullscreen'))){Plugin.eventTrigger('beforeFullscreenOff');mUtil.removeClass(body,'m-portlet--fullscreen');mUtil.removeClass(element,'m-portlet--fullscreen');Plugin.removeTooltips();Plugin.setupTooltips();if(the.foot){mUtil.css(the.body,'margin-bottom','');mUtil.css(the.foot,'margin-top','')}
Plugin.eventTrigger('afterFullscreenOff')}else{Plugin.eventTrigger('beforeFullscreenOn');mUtil.addClass(element,'m-portlet--fullscreen');mUtil.addClass(body,'m-portlet--fullscreen');Plugin.removeTooltips();Plugin.setupTooltips();if(the.foot){var height1=parseInt(mUtil.css(the.foot,'height'));var height2=parseInt(mUtil.css(the.foot,'height'))+parseInt(mUtil.css(the.head,'height'));mUtil.css(the.body,'margin-bottom',height1+'px');mUtil.css(the.foot,'margin-top','-'+height2+'px')}
Plugin.eventTrigger('afterFullscreenOn')}},eventTrigger:function(name){for(i=0;i<the.events.length;i++){var event=the.events[i];if(event.name==name){if(event.one==!0){if(event.fired==!1){the.events[i].fired=!0;event.handler.call(this,the)}}else{event.handler.call(this,the)}}}},addEvent:function(name,handler,one){the.events.push({name:name,handler:handler,one:one,fired:!1});return the}};the.setDefaults=function(options){defaultOptions=options};the.remove=function(){return Plugin.remove(html)};the.initSticky=function(){return Plugin.initSticky()};the.updateSticky=function(){return Plugin.updateSticky()};the.resetSticky=function(){return Plugin.resetSticky()};the.destroySticky=function(){return Plugin.destroySticky()};the.reload=function(){return Plugin.reload()};the.setContent=function(html){return Plugin.setContent(html)};the.toggle=function(){return Plugin.toggle()};the.collapse=function(){return Plugin.collapse()};the.expand=function(){return Plugin.expand()};the.fullscreen=function(){return Plugin.fullscreen('on')};the.unFullscreen=function(){return Plugin.fullscreen('off')};the.getBody=function(){return Plugin.getBody()};the.getSelf=function(){return Plugin.getSelf()};the.on=function(name,handler){return Plugin.addEvent(name,handler)};the.one=function(name,handler){return Plugin.addEvent(name,handler,!0)};Plugin.construct.apply(the,[options]);return the}